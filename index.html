<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Microsoft Login Example</title>
    <script src="https://alcdn.msauth.net/browser/2.30.0/js/msal-browser.min.js"></script>
</head>
<body>
    <button onclick="handleLogin()">Login with Microsoft</button>
    <script>
        const msalConfig = {
            auth: {
                clientId: "48001125-599a-489d-8ead-ce1802cc93f8", // Replace with your client ID
                authority: "https://login.microsoftonline.com/common", // Use 'common' for multi-tenant apps
                redirectUri: "https://claudeoutlook.netlify.app/" // Replace with your redirect URI
            },
            cache: {
                cacheLocation: "localStorage", // This configures where your cache will be stored
                storeAuthStateInCookie: false, // Set to true for Internet Explorer 11
            }
        };

        const msalInstance = new msal.PublicClientApplication(msalConfig);

        function handleLogin() {
            msalInstance.loginRedirect({
                scopes: ["user.read", "offline_access"] // Request the offline_access scope to get a refresh token
            });
        }

        function handleRedirectPromise() {
            return msalInstance.handleRedirectPromise().then(response => {
                if (response !== null) {
                    console.log("id_token acquired at: " + new Date().toString());
                    console.log(response);

                    // Check if the response contains a refresh token
                    if (response.refreshToken) {
                        console.log("Refresh Token: " + response.refreshToken);
                        // Store the refresh token securely
                    }

                    // Call the Graph API or other services using the access token
                } else {
                    console.log("No response object found");
                }
            }).catch(error => {
                console.error("Error handling redirect:", error);
            });
        }

        function acquireTokenSilent() {
            const accounts = msalInstance.getAllAccounts();
            if (accounts.length > 0) {
                const account = accounts[0];
                msalInstance.acquireTokenSilent({
                    scopes: ["user.read"],
                    account: account
                }).then(response => {
                    console.log("Access token acquired silently:", response.accessToken);
                    // Use the new access token
                }).catch(error => {
                    console.error("Error acquiring token silently:", error);
                    // Fallback to interactive login if silent token acquisition fails
                    msalInstance.acquireTokenRedirect({
                        scopes: ["user.read"]
                    });
                });
            }
        }

        // Call this function when your app loads
        handleRedirectPromise();
    </script>
</body>
</html>
